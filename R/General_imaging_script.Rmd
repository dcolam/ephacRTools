---
title: "Imaging_script_Gen"
author: "Athena Schumacher"
date: "2025-05-21"
output: html_document
editor_options: 
  chunk_output_type: console
---

## Load Useful Packages and Functions

```{r message=FALSE, warning=FALSE}

source("/Users/athenaschumacher/Downloads/E-Phac:Robinson_Labs/ephacRTools/R/imagingTools.R")
source("/Users/athenaschumacher/Downloads/E-Phac:Robinson_Labs/ephacRTools/R/utilityTools.R")
source("/Users/athenaschumacher/Downloads/E-Phac:Robinson_Labs/ephacRTools/R/prepareSE.R")

```


```{r}

devtools::load_all()

data("se_iN")

colData(se_iN)[15:25,]

colData(se_iN)$Image_paths

se_iN[,se_iN$Well == "H05"]$Image_paths

```

```{r}

wells <- se_iN$Well
plateIDs <- se_iN$Plate_ID

parent_folder <- "/Volumes/staff/ephacoffice/DColameo/DATA/iPSC_Tricultures"

image_paths_list <- mapply(function(well, plate, location) {
  image_paths(parent_folder, idx = well, plate = plate, location = 7)
}, well = wells, plate = plateIDs, SIMPLIFY = FALSE)

colData(se_iN)$Image_paths <- image_paths_list
```

Visualize the different channels for a given well of a given plate
```{r}

imageval(se_iN, "C09", "18T39265")

```


Adrenal cells

```{r}

wd_path <- "/Users/athenaschumacher/Downloads/E-Phac:Robinson_Labs/excel_files"

pathToTable <- "/Users/athenaschumacher/Downloads/E-Phac:Robinson_Labs/excel_files/NCI_ramp_ATP1A1_280225_18T39417.xlsx"

df <- prep_excel(pathToTable)

df <- prep_df(wd_path, df)

df <- filtered_df(df, "18T39417")

df <- group_assignment(df, pattern = "Cycle", cycle_pattern = c("HP", "WT", "HP"))

```

```{r}
se_hAG <- prepareSE(pathToTable)

colData(se_hAG)
rowData(se_hAG)
```

```{r}
se_coldata <- as.data.frame(colData(se_hAG))

df_clean <- df %>%
  select(Well, Plate_ID, Compound, Group) %>%
  distinct(Well, Plate_ID, .keep_all = TRUE)

matched <- left_join(se_coldata, df_clean, by = c("Well", "Plate_ID"))

se_hAG$Compound <- matched$Compound

se_hAG$Group <- matched$Group

colData(se_hAG)[30:40,]
```





